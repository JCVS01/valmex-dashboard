<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VALMEX | Dashboard Asesor</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Montserrat',sans-serif;background:#FFFFFF;color:#1A2540;}
:root{--navy:#00205C;--sky:#41BBC9;--blue:#3DA5E0;--silver:#D3DDE6;--gray:#5B6670;--white:#fff;--bg:#FFFFFF;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{background:var(--navy);width:100%;box-shadow:0 2px 12px rgba(0,0,0,.25);}
.brand{max-width:1600px;margin:0 auto;padding:0 40px;height:72px;display:flex;align-items:center;justify-content:space-between;}
.logo-btn{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:6px 8px;border-radius:8px;transition:background .18s;flex-shrink:0;}
.logo-btn:hover{background:rgba(255,255,255,.10);}
.logo-img{height:46px;width:auto;}
.nav{display:flex;align-items:center;gap:16px;}
.nav-tab{color:rgba(255,255,255,.75);background:transparent;border:none;font-family:'Montserrat',sans-serif;font-weight:600;font-size:17px;padding:10px 22px;border-radius:10px;cursor:pointer;transition:all .15s;white-space:nowrap;}
.nav-tab:hover{background:rgba(255,255,255,.12);color:#fff;}
.nav-tab.active{background:#fff;color:var(--navy);font-weight:700;} .logo-active{background:rgba(255,255,255,0.15)!important;border-radius:10px;}
.header-right{display:flex;align-items:center;gap:10px;flex-shrink:0;}
.advisor-avatar{width:38px;height:38px;border-radius:50%;background:var(--sky);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:var(--navy);flex-shrink:0;}
.advisor-name{font-size:15px;color:rgba(255,255,255,.85);font-weight:500;}
.btn-logout{background:none;border:none;cursor:pointer;color:rgba(255,255,255,.55);font-size:17px;padding:4px 8px;border-radius:6px;transition:color .15s;}
.btn-logout:hover{color:#fff;}
.hamburger{display:none;background:none;border:none;cursor:pointer;flex-direction:column;gap:5px;padding:6px;}
.hamburger span{display:block;width:22px;height:2px;background:#fff;border-radius:2px;}

/* ‚îÄ‚îÄ MOBILE NAV ‚îÄ‚îÄ */
.mobile-nav{display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.5);}
.mobile-panel{position:absolute;top:0;right:0;width:260px;height:100%;background:var(--navy);padding:24px 20px;display:flex;flex-direction:column;gap:6px;}
.mobile-close{background:none;border:none;color:#fff;font-size:22px;cursor:pointer;align-self:flex-end;margin-bottom:8px;}
.mobile-user{display:flex;align-items:center;gap:10px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.15);margin-bottom:8px;}
.mobile-tab{color:rgba(255,255,255,.8);background:transparent;border:none;font-family:'Montserrat',sans-serif;font-weight:600;font-size:15px;padding:11px 14px;border-radius:10px;cursor:pointer;text-align:left;width:100%;transition:all .15s;}
.mobile-tab:hover,.mobile-tab.active{background:rgba(255,255,255,.15);color:#fff;}
.mobile-logout{margin-top:auto;padding:11px 14px;color:rgba(255,255,255,.55);background:none;border:none;font-family:'Montserrat',sans-serif;font-size:13px;cursor:pointer;text-align:left;border-radius:10px;transition:all .15s;}
.mobile-logout:hover{color:#fff;background:rgba(255,255,255,.10);}

/* ‚îÄ‚îÄ CONTAINER / PAGES ‚îÄ‚îÄ */
.container{max-width:1400px;margin:0 auto;padding:24px 20px;background:#fff;} #page-presentacion{margin:-24px -20px;height:calc(100vh - 72px);flex-direction:column;} 

/* Dashboard fluido ‚Äî igual que otras pesta√±as */

#prop-dash{
  width:100%;
  background:#fff;
  padding:12px 16px;
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:16px;
  align-content:start;
}
.page{display:none;background:#fff;}.page.active{display:block;background:#fff;} #page-presentacion.active{display:flex;} #page-propuesta.active{display:flex;flex-direction:column;}

/* ‚îÄ‚îÄ BOT√ìN DESCARGA ‚îÄ‚îÄ */
.btn-dl{width:36px;height:36px;border-radius:8px;background:var(--navy);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;transition:background .18s;text-decoration:none;flex-shrink:0;}
.btn-dl:hover{background:var(--sky);}

/* ‚îÄ‚îÄ PRESENTACI√ìN ‚îÄ‚îÄ */
.pres-card{background:#fff;border-radius:0;border:none;box-shadow:none;overflow:hidden;display:flex;flex-direction:column;height:100%;}
.pres-hdr{background:#fff;border-bottom:1px solid var(--silver);padding:4px 14px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.pres-hdr h2{font-size:12px;font-weight:600;color:var(--navy);}
.pres-body{width:100%;flex:1;overflow:hidden;line-height:0;position:relative;}
.pres-body iframe{width:100%;height:100%;border:none;display:block;}

/* ‚îÄ‚îÄ PROPUESTA ‚îÄ‚îÄ */
.prop-titlebar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.prop-title-left{display:flex;align-items:center;gap:10px;}
.prop-accent{width:8px;height:28px;background:var(--sky);border-radius:3px;flex-shrink:0;}
.prop-title{font-size:22px;font-weight:900;letter-spacing:.3px;color:var(--navy);text-transform:uppercase;}
.prop-rule{height:2px;background:var(--navy);border-radius:2px;margin-bottom:14px;}
.prop-right{display:flex;align-items:center;gap:12px;} 
.prop-dash-title{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:4px 2px 6px;}

/* Grid ‚Äî desktop: 2 filas */
/* Prop grid */
/* Un solo grid de 6 columnas para toda la propuesta */
.prop-grid{display:contents;}
.prop-dash-title{grid-column:1/-1;}
.prop-rule-full{grid-column:1/-1;height:2px;background:var(--navy);border-radius:2px;margin-bottom:0.3%;}
/* Fila 1 */
.prop-row1{display:contents;}
.card-comp{grid-column:span 1;height:282px;}
.card-rend{grid-column:span 1;height:282px;}
.card-deuda{grid-column:span 1;height:282px;}
.card-back{grid-column:span 3;height:282px;}
/* Fila 2 ‚Äî cada pie = 2 cols exactas del mismo grid */
.prop-row2{display:contents;}
.card-pie{grid-column:span 2;height:330px;}

/* Card base */
.pcard{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 4px 14px rgba(0,0,0,.06);}
.pcard>.ph{background:var(--navy);color:#fff;padding:5px 10px;font-weight:700;font-size:11px;letter-spacing:.2px;flex-shrink:0;text-align:center;}
.pcard>.pb{padding:10px;flex:1 1 auto;display:flex;background:#fff;overflow:hidden;}
.pcard canvas{width:100%!important;height:100%!important;display:block;}

/* Rendimientos hoy */
.rh-grid{width:100%;height:100%;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:repeat(3,1fr);gap:6px;}
.rh-block{background:#fff;border:1px solid rgba(0,0,0,.10);border-radius:8px;padding:4px;text-align:center;display:flex;flex-direction:column;justify-content:center;}
.rh-pill{display:inline-block;background:var(--navy);color:#fff;padding:2px 6px;border-radius:6px;font-weight:800;font-size:9px;margin-bottom:3px;}
.rh-val{font-size:15px;font-weight:900;color:#111;}
.rh-val.pos{color:#16A34A;}.rh-val.neg{color:#DC2626;}.rh-val.flat{color:var(--sky);}

/* Deuda */
.deuda-inner{display:flex;flex-direction:column;gap:8px;width:100%;justify-content:center;}
.deuda-row{background:#fff;border:1px solid var(--silver);border-radius:7px;padding:7px 9px;border-left:3px solid var(--navy);}
.deuda-lbl{font-size:9px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;display:block;}
.deuda-val{font-size:12px;font-weight:800;color:var(--navy);}

/* Nota */
.prop-note{font-size:9px;color:var(--gray);margin-top:6px;font-family:'Inter',sans-serif;font-style:italic;}

/* ‚îÄ‚îÄ CONFIGURACI√ìN ‚îÄ‚îÄ */
.cfg-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:820px;margin:0 auto;}
.cfg-card{background:#fff;border:1px solid var(--silver);border-radius:12px;box-shadow:0 2px 14px rgba(0,32,92,.08);overflow:hidden;}
.cfg-hdr{background:var(--navy);padding:12px 18px;}
.cfg-hdr h3{font-size:11px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.8px;}
.cfg-body{padding:18px;}
.fg{margin-bottom:12px;}
.fg label{display:block;font-size:10px;font-weight:600;color:var(--gray);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;font-family:'Inter',sans-serif;}
.fg input,.fg select{width:100%;padding:9px 12px;border:1.5px solid var(--silver);border-radius:7px;font-size:13px;font-family:'Inter',sans-serif;color:#1A2540;background:#fff;outline:none;transition:border-color .18s;}
.fg input:focus,.fg select:focus{border-color:var(--sky);}
.btn-primary{padding:9px 22px;background:var(--navy);color:#fff;border:none;border-radius:7px;font-size:12px;font-weight:700;cursor:pointer;font-family:'Montserrat',sans-serif;transition:background .18s;}
.btn-primary:hover{background:var(--sky);color:var(--navy);}

/* ‚îÄ‚îÄ COMPARATIVA ‚îÄ‚îÄ */
.cmp-card{background:#fff;border:1px solid var(--silver);border-radius:12px;box-shadow:0 2px 14px rgba(0,32,92,.08);overflow:hidden;}
.cmp-hdr{background:var(--navy);padding:12px 20px;}
.cmp-hdr h3{font-size:11px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.8px;}
.cmp-body{padding:20px;height:360px;}

/* ‚îÄ‚îÄ ELITE ‚îÄ‚îÄ */
.elite-hero{background:linear-gradient(130deg,var(--navy) 0%,#0A3580 100%);border-radius:14px;padding:36px 40px;display:flex;align-items:center;gap:28px;box-shadow:0 8px 32px rgba(0,32,92,.22);}
.elite-icon{width:58px;height:58px;background:#C9A84C;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.elite-text h2{font-size:20px;font-weight:800;color:#fff;margin-bottom:6px;}
.elite-text p{font-size:13px;color:rgba(255,255,255,.76);font-family:'Inter',sans-serif;line-height:1.6;}
.elite-features{margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.ef-card{background:#fff;border:1px solid var(--silver);border-radius:10px;padding:16px;}
.ef-icon{width:34px;height:34px;border-radius:8px;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:16px;margin-bottom:8px;}
.ef-card h4{font-size:11px;font-weight:700;color:var(--navy);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px;}
.ef-card p{font-size:11px;color:var(--gray);font-family:'Inter',sans-serif;line-height:1.5;}

/* ‚ïê‚ïê TABLET PORTRAIT (‚â§1024px vertical) ‚ïê‚ïê */
@media(max-width:1024px) and (orientation:portrait){
  .card-comp,.card-rend,.card-deuda{grid-column:span 1;}
  .card-back{grid-column:span 3;}
  .card-pie{grid-column:span 2;}
  .cfg-grid{grid-template-columns:1fr;}
  .elite-features{grid-template-columns:1fr;}
}

/* ‚ïê‚ïê MOBILE PORTRAIT (‚â§600px vertical) ‚ïê‚ïê */
@media(max-width:600px) and (orientation:portrait){
  .nav{display:none;}
  .advisor-name{display:none;}
  .btn-logout{display:none;}
  .hamburger{display:flex;}
  .brand{padding:0 16px;height:62px;}
  .logo-img{height:34px;}
  .container{padding:12px;}
  .pres-body{height:65vh;}
  .prop-grid{grid-template-columns:1fr;}
  .card-comp,.card-rend,.card-deuda,.card-back,.card-pie{grid-column:span 1;}
  .prop-title{font-size:15px;}
  .rh-val{font-size:19px;}
  .cfg-grid{grid-template-columns:1fr;}
  .elite-hero{flex-direction:column;padding:24px 20px;}
  .elite-features{grid-template-columns:1fr;}
  .cmp-body{height:260px;}
  .prop-row1 .pcard,.prop-row2 .pcard{min-height:200px;}
}

/* ‚ïê‚ïê LANDSCAPE CELULAR (horizontal, pantalla peque√±a) ‚ïê‚ïê */
@media(orientation:landscape) and (max-height:600px){
  .nav{display:none;}
  .hamburger{display:flex;}
  .brand{padding:0 14px;height:54px;}
  .logo-img{height:30px;}
  .advisor-name{display:none;}
  .btn-logout{display:none;}
  .container{padding:8px 12px;}
  .prop-grid{gap:8px;}
  .card-comp,.card-rend,.card-deuda{grid-column:span 1;min-height:200px;}
  .card-back{grid-column:span 3;min-height:200px;}
  .card-pie{grid-column:span 2;min-height:170px;}
  .prop-title{font-size:14px;}
  .rh-val{font-size:13px;}
  .rh-pill{font-size:8px;padding:2px 5px;}
  .rh-block{padding:5px;}
  .deuda-val{font-size:11px;}
  .deuda-lbl{font-size:7.5px;}
  .deuda-row{padding:6px 8px;}
  .ph{padding:4px 10px;font-size:9.5px;line-height:1.15;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .prop-note{display:none;}
  .pres-body{height:78vh;}
}

/* ‚ïê‚ïê TABLET LANDSCAPE ‚ïê‚ïê */
@media(orientation:landscape) and (min-height:601px){
  .card-comp,.card-rend,.card-deuda{grid-column:span 1;}
  .card-back{grid-column:span 3;}
  .card-pie{grid-column:span 2;min-height:220px;}
}

@media print{
  .topbar,.prop-right{display:none!important;}
  body{background:#fff!important;}
}
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="brand">
    <div style="display:flex;align-items:center;gap:16px;flex:1;justify-content:center;">
      <button class="logo-btn" id="logo-tab" onclick="showPage('presentacion', this)" title="Presentaci√≥n">
        <img src="/VALMEX.png" class="logo-img" alt="VALMEX">
      </button>
      <nav class="nav">
        <button class="nav-tab" onclick="showPage('configuracion',this)">Configuraci√≥n</button>
        <button class="nav-tab" onclick="showPage('propuesta',this)">Propuesta</button>
        <button class="nav-tab" onclick="showPage('comparativa',this)">Comparativa</button>
        <button class="nav-tab" onclick="showPage('elite',this)">VALMEX Elite</button>
      </nav>
    </div>
    <div class="header-right">
      <div class="advisor-avatar" id="user-avatar">--</div>
      <span class="advisor-name" id="user-name"></span>
      <button class="btn-logout" onclick="window.location.href='/logout'" title="Cerrar sesi√≥n"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 4H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7"/><polyline points="17 15 20 12 17 9"/><line x1="20" y1="12" x2="9" y2="12"/></svg></button>
      <button class="hamburger" onclick="openMobileNav()" aria-label="Men√∫">
        <span></span><span></span><span></span>
      </button>
    </div>
  </div>
</header>

<!-- MOBILE NAV -->
<div class="mobile-nav" id="mobile-nav" onclick="closeMobileNav()">
  <div class="mobile-panel" onclick="event.stopPropagation()">
    <button class="mobile-close" onclick="closeMobileNav()">‚úï</button>
    <div class="mobile-user">
      <div class="advisor-avatar" id="mobile-avatar">--</div>
      <span style="color:#fff;font-size:14px;font-weight:600;" id="mobile-name"></span>
    </div>
    <button class="mobile-tab" onclick="showPage('presentacion',this);closeMobileNav()">Presentaci√≥n</button>
    <button class="mobile-tab" onclick="showPage('configuracion',this);closeMobileNav()">Configuraci√≥n</button>
    <button class="mobile-tab" onclick="showPage('propuesta',this);closeMobileNav()">Propuesta</button>
    <button class="mobile-tab" onclick="showPage('comparativa',this);closeMobileNav()">Comparativa</button>
    <button class="mobile-tab" onclick="showPage('elite',this);closeMobileNav()">VALMEX Elite</button>
    <button class="mobile-logout" onclick="window.location.href='/logout'"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 4H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7"/><polyline points="17 15 20 12 17 9"/><line x1="20" y1="12" x2="9" y2="12"/></svg> Cerrar sesi√≥n</button>
  </div>
</div>

<!-- CONTENIDO -->
<div class="container">

  <!-- PRESENTACI√ìN -->
  <div id="page-presentacion" class="page active">
    <div class="pres-card">
      <div class="pres-hdr">
        <h2>Presentaci√≥n</h2>
        <a href="/PC.pdf" download="PRESENTACI√ìN COMERCIAL VALMEX.pdf" class="btn-dl" title="Descargar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </a>
      </div>
      <div class="pres-body">
        <iframe src="/PC.pdf#toolbar=0&navpanes=0&scrollbar=0&view=FitH" title="Presentaci√≥n Comercial"></iframe>
      </div>
    </div>
  </div>

  <!-- PROPUESTA -->
  <div id="page-propuesta" class="page">
    <!-- TOOLBAR FUERA del dashboard ‚Äî NO se exporta -->
    <div class="prop-titlebar" id="prop-toolbar">
      <div></div>
      <div class="prop-right">
        <span style="font-size:11px;color:var(--gray);font-family:'Inter',sans-serif;">Exportar PDF</span>
        <button class="btn-dl" id="btn-pdf" title="Descargar PDF">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </button>
      </div>
    </div>

    <!-- DASHBOARD ‚Äî t√≠tulo y logo ADENTRO, s√≠ se exportan -->
    <div class="prop-dash-scaler"><div class="prop-grid" id="prop-dash">

      <!-- Titlebar DENTRO del dashboard -->
      <div class="prop-dash-title">
        <div class="prop-title-left">
          <div class="prop-accent"></div>
          <span class="prop-title">Estrategia Portafolio</span>
        </div>
        <img src="/VALMEX2.png" style="height:38px;width:auto;" alt="VALMEX">
      </div>
      <div class="prop-rule-full"></div>
      <!-- FILA 1 -->
      <div class="prop-row1">
        <!-- Composici√≥n -->
        <div class="pcard card-comp">
          <div class="ph">Composici√≥n</div>
          <div class="pb" style="padding:8px 6px;"><canvas id="c-comp"></canvas></div>
        </div>
        <!-- Rendimientos Hoy -->
        <div class="pcard card-rend">
          <div class="ph">Rendimientos</div>
          <div class="pb" style="padding:8px;">
            <div class="rh-grid">
              <div class="rh-block"><span class="rh-pill">MTD</span><span class="rh-val pos">0.13%</span></div>
              <div class="rh-block"><span class="rh-pill">3 Meses</span><span class="rh-val pos">1.31%</span></div>
              <div class="rh-block"><span class="rh-pill">YTD</span><span class="rh-val pos">8.15%</span></div>
              <div class="rh-block"><span class="rh-pill">12 Meses</span><span class="rh-val pos">7.90%</span></div>
              <div class="rh-block"><span class="rh-pill">24 Meses</span><span class="rh-val pos">12.54%</span></div>
              <div class="rh-block"><span class="rh-pill">36 Meses</span><span class="rh-val pos">12.55%</span></div>
            </div>
          </div>
        </div>
        <!-- Deuda -->
        <div class="pcard card-deuda">
          <div class="ph">Drilldown Deuda</div>
          <div class="pb" style="padding:10px;">
            <div class="deuda-inner">
              <div class="deuda-row"><span class="deuda-lbl">Duraci√≥n</span><span class="deuda-val">1.30 / 4.97</span></div>
              <div class="deuda-row"><span class="deuda-lbl">Yield to Maturity</span><span class="deuda-val">8.55% / 5.19%</span></div>
              <div class="deuda-row"><span class="deuda-lbl">Calificaci√≥n Crediticia</span><span class="deuda-val">BBB, AA / AA</span></div>
            </div>
          </div>
        </div>
        <!-- L√≠nea -->
        <div class="pcard card-back">
          <div class="ph">Backtesting</div>
          <div class="pb" style="padding:10px;"><canvas id="c-linea"></canvas></div>
        </div>
      </div>

      <!-- FILA 2 -->
      <div class="prop-row2">
        <div class="pcard card-pie">
          <div class="ph">Clase de activos</div>
          <div class="pb" style="padding:6px;"><canvas id="c-clase"></canvas></div>
        </div>
        <div class="pcard card-pie">
          <div class="ph">Exposici√≥n geogr√°fica RV</div>
          <div class="pb" style="padding:6px;"><canvas id="c-geo"></canvas></div>
        </div>
        <div class="pcard card-pie">
          <div class="ph">Exposici√≥n Sectorial RV</div>
          <div class="pb" style="padding:6px;"><canvas id="c-sector"></canvas></div>
        </div>
      </div>
    </div>
    </div><!-- /.prop-dash-scaler -->
    <p class="prop-note">*Rendimientos con plazo menor a un a√±o est√°n expresados en t√©rminos efectivos y los rendimientos mayores a un a√±o en t√©rminos anualizados. Los rendimientos se encuentran actualizados al 31/12/2025.</p>
  </div>

  <!-- CONFIGURACI√ìN -->
  <div id="page-configuracion" class="page">
    <div class="cfg-grid">
      <div class="cfg-card">
        <div class="cfg-hdr"><h3>Datos del Cliente</h3></div>
        <div class="cfg-body">
          <div class="fg"><label>Nombre completo</label><input type="text" placeholder="Ej. Mar√≠a Garc√≠a L√≥pez"></div>
          <div class="fg"><label>Perfil de riesgo</label>
            <select><option>Conservador</option><option>Moderado</option><option selected>Balanceado</option><option>Crecimiento</option><option>Agresivo</option></select>
          </div>
          <div class="fg"><label>Monto del portafolio (MXN)</label><input type="number" placeholder="5,000,000"></div>
          <button class="btn-primary">Guardar cliente</button>
        </div>
      </div>
      <div class="cfg-card">
        <div class="cfg-hdr"><h3>Par√°metros del Portafolio</h3></div>
        <div class="cfg-body">
          <div class="fg"><label>Benchmark</label>
            <select><option>CETES 28d</option><option selected>IPC + CETES</option><option>S&P 500</option></select>
          </div>
          <div class="fg"><label>Horizonte de inversi√≥n</label>
            <select><option>1 a√±o</option><option selected>3 a√±os</option><option>5 a√±os</option><option>10+ a√±os</option></select>
          </div>
          <div class="fg"><label>Moneda de reporte</label>
            <select><option selected>MXN</option><option>USD</option></select>
          </div>
          <button class="btn-primary">Aplicar par√°metros</button>
        </div>
      </div>
    </div>
  </div>

  <!-- COMPARATIVA -->
  <div id="page-comparativa" class="page">
    <div class="cmp-card">
      <div class="cmp-hdr"><h3>Comparativa de Portafolios</h3></div>
      <div class="cmp-body"><canvas id="c-comp2"></canvas></div>
    </div>
  </div>

  <!-- ELITE -->
  <div id="page-elite" class="page">
    <div class="elite-hero">
      <div class="elite-icon">‚≠ê</div>
      <div class="elite-text">
        <h2>VALMEX ELITE</h2>
        <p>Acceso exclusivo a estrategias de inversi√≥n de alto impacto, an√°lisis cuantitativo avanzado y reporter√≠a personalizada para patrimonios significativos.</p>
      </div>
    </div>
    <div class="elite-features">
      <div class="ef-card"><div class="ef-icon">üìä</div><h4>An√°lisis Cuantitativo</h4><p>Modelos propietarios con datos de Morningstar y Bloomberg para optimizaci√≥n de portafolios.</p></div>
      <div class="ef-card"><div class="ef-icon">üåê</div><h4>Acceso Global</h4><p>M√°s de 10,000 instrumentos en 45 mercados internacionales.</p></div>
      <div class="ef-card"><div class="ef-icon">üìÑ</div><h4>Reporter√≠a Premium</h4><p>Presentaciones ejecutivas automatizadas con tu branding y datos en tiempo real.</p></div>
    </div>
  </div>

</div><!-- /.container -->

<script>
// ‚îÄ‚îÄ NAVEGACI√ìN ‚îÄ‚îÄ
const PAGES = ['presentacion','propuesta','configuracion','comparativa','elite'];


function showPage(name, el) {
  // 1. Activar p√°gina correcta
  PAGES.forEach(id => document.getElementById('page-'+id).classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');

  // 2. Nav desktop: quitar active de todos los nav-tab
  document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));

  // 3. Nav m√≥vil: quitar active de todos los mobile-tab
  document.querySelectorAll('.mobile-tab').forEach(b => b.classList.remove('active'));

  // 4. Marcar el elemento que se clicke√≥ (desktop o m√≥vil)
  if (el && (el.classList.contains('nav-tab') || el.classList.contains('mobile-tab'))) {
    el.classList.add('active');
  }

  // 5. Sincronizar el tab equivalente en el otro men√∫
  const nameMap = {
    'presentacion': 'presentaci√≥n',
    'configuracion': 'configuraci√≥n',
    'propuesta': 'propuesta',
    'comparativa': 'comparativa',
    'elite': 'valmex elite'
  };
  const label = nameMap[name] || name;
  // Si vino del desktop, marcar en m√≥vil
  if (el && el.classList.contains('nav-tab')) {
    document.querySelectorAll('.mobile-tab').forEach(b => {
      if (b.textContent.trim().toLowerCase() === label) b.classList.add('active');
    });
  }
  // Si vino del m√≥vil, marcar en desktop
  if (el && el.classList.contains('mobile-tab')) {
    document.querySelectorAll('.nav-tab').forEach(b => {
      if (b.textContent.trim().toLowerCase() === label) b.classList.add('active');
    });
  }

  // 6. Logo = pesta√±a Presentaci√≥n
  const logo = document.getElementById('logo-tab');
  if (name === 'presentacion') logo.classList.add('logo-active');
  else logo.classList.remove('logo-active');

  // 7. Resize charts si es propuesta
  if (name === 'propuesta') {
    setTimeout(() => {
      Object.values(charts).forEach(c => c && c.resize && c.resize());
      
    }, 80);
  }
  window.scrollTo(0,0);
}
function openMobileNav()  { document.getElementById('mobile-nav').style.display='block'; document.body.style.overflow='hidden'; }
function closeMobileNav() { document.getElementById('mobile-nav').style.display='none';  document.body.style.overflow=''; }

// ‚îÄ‚îÄ USUARIO ‚îÄ‚îÄ
document.getElementById('logo-tab').classList.add('logo-active');
fetch('/me')
  .then(r => r.ok ? r.json() : null)
  .then(user => {
    if (!user || !user.ok) return;
    document.getElementById('user-avatar').textContent = user.iniciales;
    document.getElementById('user-name').textContent   = user.nombre;
    document.getElementById('mobile-avatar').textContent = user.iniciales;
    document.getElementById('mobile-name').textContent   = user.nombre;
    // Todos los usuarios tienen acceso completo
  }).catch(()=>{});

// ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ
Chart.defaults.font.family = "'Inter',sans-serif";
Chart.defaults.font.size   = 11;
Chart.defaults.color       = '#5B6670';

const PAL = ['#00205C','#3DA5E0','#41BBC9','#1A4A8A','#F59E0B','#2E6DB4','#5B9BD5','#8FB8E0','#B8D4ED','#0A3580','#6BAED6'];
const charts = {};

// Composici√≥n barra horizontal
charts.comp = new Chart(document.getElementById('c-comp'),{
  type:'bar',
  data:{
    labels:['VLMXETF','VXDEUDA','VXGUBCP','VXUDIMP','VALMX28','VALMXVL','VLMXTEC','VLMXDME'],
    datasets:[{data:[34.37,22.52,10.00,10.00,6.90,6.90,5.00,4.31],backgroundColor:'#3DA5E0',borderRadius:0,barPercentage:.65}]
  },
  options:{
    indexAxis:'y',responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false}},
    layout:{padding:{right:38}},
    scales:{
      x:{display:false,max:42,grid:{display:false}},
      y:{grid:{display:false},ticks:{font:{size:9,weight:'700'},color:'#00205C'},border:{display:false}}
    }
  },
  plugins:[{id:'pct',afterDatasetsDraw(chart){
    const {ctx,scales:{x,y}}=chart; ctx.save();
    chart.data.datasets[0].data.forEach((val,i)=>{
      const bar=chart.getDatasetMeta(0).data[i];
      ctx.fillStyle='#00205C';ctx.font='bold 9px Inter,sans-serif';ctx.textBaseline='middle';
      ctx.fillText(val+'%',x.getPixelForValue(val)+4,bar.y);
    });
    ctx.restore();
  }}]
});

// L√≠nea 2016-2024
charts.linea = new Chart(document.getElementById('c-linea'),{
  type:'line',
  data:{
    labels:['2016','2017','2018','2019','2020','2021','2022','2023','2024'],
    datasets:[
      {label:'Propuesta',data:[100,108,112,122,115,140,150,170,200],borderColor:'#3DA5E0',backgroundColor:'transparent',borderWidth:2.5,pointRadius:2,tension:.4},
      {label:'Bench propuesta',data:[100,106,110,118,112,134,144,162,193],borderColor:'#F59E0B',backgroundColor:'transparent',borderWidth:2,pointRadius:2,tension:.4,borderDash:[4,3]}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{position:'bottom',labels:{boxWidth:10,font:{size:10},padding:10,usePointStyle:true}}},
    scales:{
      x:{grid:{display:false},ticks:{font:{size:9.5}},border:{display:false}},
      y:{min:90,grid:{display:false},ticks:{font:{size:9.5}},border:{display:false}}
    }
  }
});

// Donuts
function donut(id,labels,data,colors){
  const isPortraitMobile = window.innerWidth <= 600 && window.innerHeight > window.innerWidth;
  const isMobile = isPortraitMobile;
  return new Chart(document.getElementById(id),{
    type:'doughnut',
    data:{labels,datasets:[{data,backgroundColor:colors||PAL.slice(0,data.length),borderWidth:1.5,borderColor:'#fff',hoverOffset:5}]},
    options:{responsive:true,maintainAspectRatio:false,cutout:'60%',
      plugins:{legend:{
        position: isMobile ? 'bottom' : 'right',
        labels:{boxWidth:9,font:{size: isMobile ? 10 : 9.5},padding: isMobile ? 8 : 6,color:'#1A2540'}
      }}
    }
  });
}
charts.clase  = donut('c-clase', ['Deuda Local','RV Global','Deuda Global'],[76.9,18.8,4.3],['#00205C','#3DA5E0','#F59E0B']);
charts.geo    = donut('c-geo',   ['Norte-Am√©rica','Eurozona','Europa','Am√©rica Latina','Otros emergentes','Asia Emergente','Jap√≥n','Asia-Pac√≠fico'],[65.49,12.81,7.66,3.89,3.25,2.37,2.3,2.23]);
charts.sector = donut('c-sector',['Tecnolog√≠a','Financiero','Salud','Comunicaciones','Industriales','Consumo discrecional','Consumo b√°sico','Materiales','Energ√≠a'],[32.57,15.25,12.64,8.51,8.4,7.93,5.13,4.2,3.0]);

// Comparativa
charts.comp2 = new Chart(document.getElementById('c-comp2'),{
  type:'bar',
  data:{
    labels:['Conservador','Moderado','Balanceado','Crecimiento','Agresivo'],
    datasets:[
      {label:'Rendimiento 1A (%)',data:[4.2,6.8,9.4,12.1,15.7],backgroundColor:'#00205C',borderRadius:4,barPercentage:.5},
      {label:'Benchmark 1A (%)', data:[3.1,5.2,7.6,9.8,12.4], backgroundColor:'#41BBC9',borderRadius:4,barPercentage:.5}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{legend:{position:'top',labels:{font:{size:12},padding:14}}},
    scales:{
      x:{grid:{display:false},border:{display:false}},
      y:{grid:{color:'rgba(0,0,0,.05)'},border:{display:false},ticks:{callback:v=>v+'%'}}
    }
  }
});

// PDF Export ‚Äî US Letter horizontal, m√°rgenes 1.27cm
document.getElementById('btn-pdf').addEventListener('click',async()=>{
  const {jsPDF}=window.jspdf;
  const el=document.getElementById('prop-dash');

  // Carta horizontal sin m√°rgenes: 279.4 x 215.9 mm
  const MARGIN=0, AREA_W=279.4, AREA_H=215.9;

  const cv = await html2canvas(el, {
    scale: 3, useCORS: true, backgroundColor: '#ffffff',
    logging: false
  });
  const img=cv.toDataURL('image/png');

  // Mantener proporci√≥n dentro del √°rea √∫til
  const imgRatio=cv.width/cv.height;
  const areaRatio=AREA_W/AREA_H;
  let imgW,imgH;
  if(imgRatio>areaRatio){imgW=AREA_W;imgH=AREA_W/imgRatio;}
  else{imgH=AREA_H;imgW=AREA_H*imgRatio;}

  // Centrar con m√°rgenes exactos
  const offsetX=MARGIN+(AREA_W-imgW)/2;
  const offsetY=MARGIN+(AREA_H-imgH)/2;

  const pdf=new jsPDF({orientation:'landscape',unit:'mm',format:'letter'});
  pdf.addImage(img,'PNG',offsetX,offsetY,imgW,imgH);
  pdf.save('PROPUESTA DE INVERSI√ìN VALMEX.pdf');
});
</script>
</body>
</html>
